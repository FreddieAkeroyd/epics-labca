EPICS_TOP = /home/till/epics/
EPICS_BASE = $(EPICS_TOP)/base-3.14.beta1/
EPICS_EXTENSIONS = $(EPICS_TOP)/extensions
SCIDIR = /usr/lib/scilab-2.5

HARCH = linux-x86
TARCH = Linux
PTHREAD = -lpthread
LIBS = -L$(EPICS_BASE)/lib/$(HARCH)/ -lca -lCom -lreadline -ltermcap -lrt
INCS = -I$(EPICS_BASE)/include/ -I$(EPICS_BASE)/include/os/$(TARCH)
EINCS = -I$(EPICS_EXTENSIONS)/include/
ELIBS = -L$(EPICS_EXTENSIONS)/lib/$(HARCH)/ -lezca

INTERSCI = $(SCIDIR)/bin/intersci

all: ezcalib ezca.o ecget

ezca.o: ezca.tmp.f
	$(FC) -c $(FFLAGS) -o $@ $<

ezca.tmp.f: ezca.f
	$(RM) -f $@
	sed -e 's|SCIDIR|$(SCIDIR)|g' $^ > $@

ezca.f:	ezca.desc
	$(SCIDIR)/bin/intersci $(<:%.desc=%)
	

ecget.o: ecget.c
	$(CC) -c $(CFLAGS) -fPIC -DSCILAB_APP $(INCS) $(EINCS) -I$(SCIDIR) $<

ezcaWrap.o: ezcaWrap.cc
	$(CXX) -c $(CFLAGS) -fPIC $(INCS) $(EINCS) -I$(SCIDIR) $<

#	$(CC) -Wl,"-Ur,-u ezcaGet" -o $@ -L/usr/local/epics-3.14_a2/base/lib/$(HARCH)/ $(ELIBS) -lca -lCom
ezcalib:  ezcaWrap.o ecget.o
	$(CXX) -r -o $@ $^ $(ELIBS) $(LIBS)
#	$(LD) -i -o $@ $^ -L/usr/lib $(ELIBS) -lezca /usr/local/epics-3.14_a2/base/lib/$(HARCH)/libca.a /usr/local/epics-3.14_a2/base/lib/$(HARCH)/libCom.a /usr/lib/libpthread.a /usr/lib/libreadline.a /usr/lib/libtermcap.a /usr/lib/librt.a /usr/lib/gcc-lib/i386-redhat-linux/2.96/libgcc.a 

ecget: ecget.c
#	$(CC) -O2 -o $@ $^ $(INCS) $(LIBS)
	$(CC) $(CFLAGS) -o $@ $^ -DCMDLINE_APP $(INCS) $(LIBS) $(PTHREAD)

caInf: caInf.c
	$(CC) -O2 -o $@ $^ $(EINCS) $(INCS) $(ELIBS) $(LIBS) $(PTHREAD)

clean:
	$(RM) ezcalib *.o ezca.f ecget caInf ezca.tmp.f ezca.sce
